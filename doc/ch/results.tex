\chapter{Analysis of performance}

The execution time is measured and analyzed in detail.

\section{Variables of interest}

A simple test to determine the performance of the simulator is to measure the
time per iteration (using the wall clock). The time spent in the different
stages of the simulation can also be of interest.

Consider the sequence of time per iteration (also referred simply as the time)
$T_0,\ldots,T_n$ as independent random variables from a common distribution with
an unknown mean $\mu$ and finite standard deviation $\sigma$. The sample mean
$\overline T$ can be approximated with a certain degree of confidence by a
process of sampling.

Different parameters of the simulation may affect the time mean $\mu$ and is the
objective of this chapter to find out what the relation is. The time is at least
in $O(N_p)$, as we need to iterate over each particle $N_p$. We also know that
the worst-case complexity of the FFT is in $O(N_g \log N_g)$ for $N_g$ total grid
points.

The simulator runs for at least 30 iterations, and then the standard error of 
the mean (SEM) is computed. Then in each iteration is determined if the SEM is 
below a threshold to stop the simulation. The threshold is determined so that 
when the simulation stops, the mean is has an error of at most 0.2\% with 
probability 95\%.

\subsection{Number of particles}

The number of particles $N_p$ is one of the main parameters that affect the
running time of each iteration. In order to characterize the scalability of the
application, several tests are designed with increasing number of particles, and
different metrics are compared.

The wall clock is used in the process with rank zero to measure how long takes
each iteration.

\begin{figure}[h]
	\centering
	\subfloat[1024 particles, 512x512 grid points]{
		\begin{tikzpicture}
		\begin{axis}[
			width=0.5\textwidth,
			xlabel=Particles $N_p$,
			ylabel=Time per iteration (s),
			grid=major]
		\addplot [only marks,mark=none,error bars/y dir=both, error bars/y explicit] 
		table [
			x index = {0},
			y index = {3},
			y error index={4},
			col sep=space] {csv/particles.csv};
		\end{axis}
		\end{tikzpicture}
	}
	\subfloat[The number of grid points in incremented]{
		\begin{tikzpicture}
		\begin{axis} [
			grid=major,
			xlabel=Grid points $N_g$,
			ylabel=Time per iteration (s),
			width=0.5\textwidth]
		\addplot [only marks,mark=none,error bars/y dir=both, error bars/y explicit] 
		table [
			x index = {0},
			y index = {3},
			y error index={4},
			col sep=space] {csv/solver.csv};
		\end{axis}
		\end{tikzpicture}
	}
	\caption{The effect of the variables $N_p$ and $N_g$ to the time per 
	iteration. Using one MPI process and 32 CPUs with TAMPI enabled.}
\end{figure}


