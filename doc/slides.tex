\documentclass{beamer}

\beamertemplatenavigationsymbolsempty
\setbeamerfont{page number in head/foot}{size=\small}
\setbeamertemplate{footline}[frame number]
\usefonttheme[onlymath]{serif}

\usepackage[utf8]{inputenc}

\usepackage[T1]{fontenc}
\usepackage[english]{babel}
%\usepackage[utf8]{inputenc}

\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{arrows, backgrounds}
\usetikzlibrary{matrix, arrows.meta}
\usetikzlibrary{decorations.pathreplacing}

%\usepackage{amsfonts}
%\usepackage{amsmath}
%\usepackage{amsthm}
\usepackage{bm}

\usepackage{pgfplots}
\pgfplotsset{compat=1.3}
\usepgfplotslibrary{groupplots}

% Used for split environment
\usepackage{amsmath}
% Separate rows in align environment by this amount
\addtolength{\jot}{1em}

\usepackage{graphicx}
\graphicspath{{../fig/} {fig/}}
\usepackage{subfig}
\usepackage{wrapfig}

% Clickable links
\usepackage{hyperref}
\hypersetup{
	colorlinks,
	citecolor=black,
	filecolor=black,
	linkcolor=black,
	urlcolor=black
}

\usepackage[pdf]{graphviz}

%\usepackage[dvipsnames]{xcolor}
\usepackage{listings}

\lstset{
	language=c,
  basicstyle=\small\ttfamily,  % the size of the fonts that are used for the code
	numbers=none,                   % where to put the line-numbers
  inputencoding=latin1,
  numberstyle=\tiny,  % the style that is used for the line-numbers
  stepnumber=1,                   % the step between two line-numbers. If it's
				    %1, each line 
                                  % will be numbered
  %numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{white},      % choose the background color.
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,      % show tabs within strings adding particular underscores
	frame=none,                   % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed
				   % on line-breaks within not-black text (e.g.
				   % comments (green here))
	tabsize=6,                      % sets default tabsize to 2 spaces
  columns=fullflexible,
  extendedchars=true,
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen
				    %at whitespace
  title=\lstname,                   % show the filename of files included with
				    %\lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},          % keyword style
	commentstyle=\color{gray},       % comment style
	stringstyle=\color{brown},         % string literal style
  escapeinside={\%*}{*)},            % if you want to add LaTeX within your code
	morecomment=[l][\color{purple}]{\#},
	moredelim=[il][\color{purple}]{@},
%	abovecaptionskip=-15pt
%	belowcaptionskip=-15pt
}


\usepackage{csquotes}

\usepackage{siunitx}

\usepackage{multicol}

\usepackage{epigraph}
\setlength{\epigraphwidth}{0.7\textwidth}

\usepackage{caption}
\captionsetup{font=footnotesize}

% Macros para ayudar a la redacci√≥n
% Vector
\newcommand*\mat[1]{ \begin{pmatrix} #1 \end{pmatrix}}
\newcommand*\arr[1]{ \begin{bmatrix} #1 \end{bmatrix}}
\newcommand*\V[1]{\bm{#1}}
\newcommand{\E}{\V{E}}
\newcommand{\rhog}{\rho_\text{ghost}}
\newcommand{\F}{\V{F}}
\newcommand{\B}{\V{B}}
\renewcommand*{\v}{\V{v}}
\newcommand{\x}{\V{x}}
\newcommand{\dt}{\Delta t}
\newcommand{\dx}{\Delta x}
\newcommand*\neigh[1]{\mathcal{N}(#1)}

% Norm
\newcommand\norm[1]{\left\lVert#1\right\rVert}

\title{Particle-in-cell plasma simulation with OmpSs-2}
\author{Rodrigo Arias Mallo}
\date{\today}

\begin{document}

\frame{\titlepage}

\begin{frame}
\frametitle{Outline}
\tableofcontents
\end{frame}

\section{Introduction}

\begin{frame}{Introduction}
What exactly is a plasma?

Talk about 2D only.

Introduce species.

Plasma must be neutral.

\end{frame}

\section{Model}

\begin{frame}{Vlaslov equation}
The Vlaslov equation describes the evolution of a plasma, with long range 
iteration between particles.
\begin{equation}
\frac {\partial f_j}{\partial t} +
\v \cdot \frac {\partial f_j}{\partial \V x } +
\frac{q_j}{m_j} \left( \E + \frac{\v \times \B}{c} \right) \cdot
	\frac {\partial f_j}{\partial \V v}
=0
\end{equation}
Where $f_j(\x,\v,t)$ is the distribution function of the specie $j$, and the 
fields electric $\E$ and magnetic $\B$ are determined by Maxwell equations.
\end{frame}

\begin{frame}{Maxwell equations}{}
The evolution of the fields is governed by the Maxwell equations
\small
\begin{align}
\begin{split}
\nabla \cdot \E &= \frac {\rho }{\epsilon_0} \\
\nabla \cdot \B &= 0 \\
\end{split}
&
\begin{split}
\nabla \times \E &= - \frac {\partial \B }{\partial t} \\
\nabla \times \B &= \mu_0 \left(\V J +
	\epsilon_0 \frac{\partial \E}{\partial t}\right) \\
\end{split}
\end{align}
%
\normalsize
Where $\rho$ is the charge density distribution, $\V J$ the current field and
$\epsilon_0$ and $\mu_0$ are constants.

\end{frame}


\begin{frame}{Electrostatic approximation}{}
In our model, we will only have a \textbf{strong fixed magnetic field} $\B_0$ 
and the Maxwell equations can be simplified.
\small
\begin{align}
\begin{split}
\nabla \cdot \E &= \frac {\rho }{\epsilon_0} \\
\end{split}
&
\begin{split}
\nabla \times \E &= 0 \\
\end{split}
\end{align}
\normalsize
\pause
As the electric field is irrotational, we can introduce a scalar field $\phi$, 
the electric potential, and rewrite $\E$ as a gradient
\begin{align}
\nabla^2 \phi = - \frac{\rho}{\epsilon_0},
&
\quad
\E = - \nabla \phi
\end{align}
This approximation is called \textbf{electrostatic} as opposed to the 
\textbf{electromagnetic} case, when $\B$ varies with time.
\end{frame}

%\section{Discrete model}

\begin{frame}{The particle-in-cell method}{}
Solving the Vlaslov equation directly is very \textbf{computationally 
expensive}. The current solution is to introduce a spatial grid where the 
Maxwell equations are solved.

\vspace{1em}
The distribution function $f_j$ is then modeled by macro-particles which 
interact with the grid by an interpolation method.

\vspace{1em}
This method is known as \textbf{particle-in-cell} (PIC).
\end{frame}

\begin{frame}{The particle-in-cell method}{}
The space of length $\V L$ is discretized into grid points with a separation 
$\Delta \x$.

\vspace{1em}
The scalar fields $\rho$ and $\phi$ are now matrices of size $\V G = (G_x, G_y)$

\vspace{1em}
The vector field $\E$ is decomposed into $E_x$ and $E_y$, which are now matrices 
of the same size.

\end{frame}

\begin{frame}{The particle-in-cell method}{}

The PIC method has four main steps

\begin{itemize}
\setlength\itemsep{1em}
\item \textbf{Charge accumulation}: The charge density $\rho$ is interpolated in 
the grid from the particle positions.
\pause
\item \textbf{Solve field equation}: From the charge density the electric 
potential is obtained $\phi$ and then the electric field $\E$.
\pause
\item \textbf{Interpolation of electric field}: The electric field is  
interpolated back to the particle positions.
\pause
\item \textbf{Particle motion}: The force is computed from the electric field at 
the particle position and the particle is moved accordingly.
\end{itemize}
\end{frame}

\begin{frame}{Charge accumulation}{}

At each grid point $g$ at $\x$, the charge of each particle $p$ at $\x_p$ is 
accumulated using an interpolation function $W$.
\begin{equation}%{{{
\rho(\x) = \sum_p q\,W(\x - \x_p) + \rho_0
\label{eq:charge-accumulation}
\end{equation}%}}}
Using linear interpolation, we can define $W$ for two dimensions as
\begin{equation}%{{{
W(\x) =
\begin{cases}
			\displaystyle\left(1 - \frac{|x|}{\Delta x}\right)
				\left(1 - \frac{|y|}{\Delta y}\right) & \text{if}\ -\Delta\x < \x < 
				\Delta \x\\
			0 & \text{otherwise}
\end{cases}
\end{equation}%}}}
\end{frame}


\begin{frame}{Charge accumulation}{}
\begin{figure}[]%{{{
\centering
\scalebox{0.7} {
\begin{tikzpicture}[
		>=latex,
		effect/.style={dashed,-{Latex[length=3mm, width=1mm]}},
		particle/.style={fill=black,radius=3pt},
	]
	\draw [step=2cm,dotted] (1,1) grid (5,5);
	\coordinate (p) at (2.5,3.2);
	\coordinate (center) at (3,3);
	\coordinate (A) at ($(center)+(-1,1)$);
	\coordinate (B) at ($(center)+(1,1)$);
	\coordinate (C) at ($(center)+(1,-1)$);
	\coordinate (D) at ($(center)+(-1,-1)$);
	\draw[effect] (p) -- (A);
	\draw[effect] (p) -- (B);
	\draw[effect] (p) -- (C);
	\draw[effect] (p) -- (D);
	\node[above left]  at (A) {$A$};
	\node[above right] at (B) {$B$};
	\node[below right] at (C) {$C$};
	\node[below left]  at (D) {$D$};
	\draw[particle] (p) circle;
	\node[left] at (p) {$p$};
\end{tikzpicture}
\hspace{0.5cm}
\begin{tikzpicture}[
		>=latex,
		box/.style={black},
		particle/.style={fill=black,radius=3pt},
		div/.style={dashed},
	]
	\draw [step=2cm,dotted] (1,1) grid (5,5);
	\coordinate (p) at (2.5,3.2);
	\coordinate (center) at (3,3);
	\coordinate (A) at ($(p)+(-1,1)$);
	\coordinate (B) at ($(p)+(1,1)$);
	\coordinate (C) at ($(p)+(1,-1)$);
	\coordinate (D) at ($(p)+(-1,-1)$);
	\draw[box] (A) -- (B) -- (C) -- (D) -- (A);
	\draw[div] ($(A)!(center)!(B)$) -- (center);
	\draw[div] ($(B)!(center)!(C)$) -- (center);
	\draw[div] ($(C)!(center)!(D)$) -- (center);
	\draw[div] ($(D)!(center)!(A)$) -- (center);
	\node at ($(center)!0.5!(A)$) {$a$};
	\node at ($(center)!0.5!(B)$) {$b$};
	\node at ($(center)!0.5!(C)$) {$c$};
	\node at ($(center)!0.5!(D)$) {$d$};
	\draw[particle] (p) circle;
\end{tikzpicture}
\hspace{0.5cm}
\begin{tikzpicture}[
		>=latex,
		box/.style={black},
		particle/.style={fill=black,radius=3pt},
		div/.style={dashed},
	]
	\draw [step=2cm,dotted] (1,1) grid (5,5);
	\coordinate (p) at (2.5,3.2);
	\coordinate (center) at (3,3);
	\coordinate (A) at ($(center)+(-1,1)$);
	\coordinate (B) at ($(center)+(1,1)$);
	\coordinate (C) at ($(center)+(1,-1)$);
	\coordinate (D) at ($(center)+(-1,-1)$);
	\draw[box] (A) -- (B) -- (C) -- (D) -- (A);
	\draw[div] ($(A)!(p)!(B)$) -- (p);
	\draw[div] ($(B)!(p)!(C)$) -- (p);
	\draw[div] ($(C)!(p)!(D)$) -- (p);
	\draw[div] ($(D)!(p)!(A)$) -- (p);
	\node at ($(p)!0.5!(A)$) {$c$};
	\node at ($(p)!0.5!(B)$) {$d$};
	\node at ($(p)!0.5!(C)$) {$a$};
	\node at ($(p)!0.5!(D)$) {$b$};
	\draw[particle] (p) circle;
\end{tikzpicture}
}
\caption{Interpolation of particle $p$ charge into the four grid points A to D.}
\label{fig:interpolation}
\end{figure}%}}}
\end{frame}

\begin{frame}{Field equations}{}
\end{frame}

\section{Sequential simulator}
\section{Parallel simulator}
\section{Results}
\section{Discussion}

\begin{frame}{End}
Thanks for your attention.
\end{frame}

\end{document}
